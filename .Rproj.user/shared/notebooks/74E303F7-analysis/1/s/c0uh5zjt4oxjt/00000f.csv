"0","# Add this before your stability_summary code"
"0","cat(""Date range in results$stability$daily:"", "
"0","    format(min(results$stability$daily$date, na.rm = TRUE)), ""to"", "
"0","    format(max(results$stability$daily$date, na.rm = TRUE)), ""\n"")"
"1","Date range in results$stability$daily:"
"1"," "
"1","4516388-10-11"
"1"," "
"1","to"
"1"," "
"1","4567011-08-02"
"1"," "
"1","
"
"0","# Check period distribution after mutate"
"0","stability_check <- results$stability$daily %>%"
"0","  mutate(period = case_when("
"0","    date < as.Date(""2022-05-08"") ~ ""pre_crash"","
"0","    date <= as.Date(""2022-05-15"") ~ ""crash_period"","
"0","    TRUE ~ ""post_crash"""
"0","  ))"
"0",""
"0","cat(""Period distribution after mutate:\n"")"
"1","Period distribution after mutate:
"
"0","print(table(stability_check$period))"
"1","
"
"1","post_crash "
"1","
"
"1","      1290 "
"1","
"
"0","# Now proceed with your original code"
"0","stability_summary <- results$stability$daily %>%"
"0","  # First add the period column"
"0","  mutate(period = case_when("
"0","    date < as.Date(""2022-05-08"") ~ ""pre_crash"","
"0","    date <= as.Date(""2022-05-15"") ~ ""crash_period"","
"0","    TRUE ~ ""post_crash"""
"0","  )) %>%"
"0","  # Then group by token and period"
"0","  group_by(token, period) %>%"
"0","  summarize("
"0","    mean_peg_deviation = mean(peg_deviation, na.rm = TRUE),"
"0","    max_peg_deviation = max(peg_deviation, na.rm = TRUE),"
"0","    stress_ratio = max_peg_deviation / mean_peg_deviation,"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  arrange(period, desc(max_peg_deviation))"
"0",""
"0","print(stability_summary)"
