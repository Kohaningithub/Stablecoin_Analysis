"0","# Use stability data directly for analysis"
"0","if(!is.null(results$stability$daily)) {"
"0","  # Filter for UST"
"0","  ust_stability <- results$stability$daily %>%"
"0","    filter(token == ""UST"")"
"0","  "
"0","  if(nrow(ust_stability) > 0) {"
"0","    # Plot UST peg deviation over time"
"0","    ggplot(ust_stability, aes(x = date, y = peg_deviation)) +"
"0","      geom_line(color = ""blue"") +"
"0","      geom_vline(xintercept = as.Date(""2022-05-08""), linetype = ""dashed"") +"
"0","      geom_vline(xintercept = as.Date(""2022-05-15""), linetype = ""dashed"") +"
"0","      labs(title = ""UST Peg Deviation Over Time"","
"0","           x = ""Date"", y = ""Deviation from $1 peg"")"
"0","    "
"0","    # Create a period variable"
"0","    ust_stability <- ust_stability %>%"
"0","      mutate("
"0","        period = case_when("
"0","          date < as.Date(""2022-05-08"") ~ ""pre_crash"","
"0","          date <= as.Date(""2022-05-15"") ~ ""crash_period"","
"0","          TRUE ~ ""post_crash"""
"0","        )"
"0","      )"
"0","    "
"0","    # Summarize by period"
"0","    ust_by_period <- ust_stability %>%"
"0","      group_by(period) %>%"
"0","      summarize("
"0","        mean_deviation = mean(peg_deviation, na.rm = TRUE),"
"0","        max_deviation = max(peg_deviation, na.rm = TRUE),"
"0","        days = n(),"
"0","        .groups = ""drop"""
"0","      )"
"0","    "
"0","    # Print summary"
"0","    print(ust_by_period)"
"0","    "
"0","    # Plot by period"
"0","    ggplot(ust_by_period, aes(x = period, y = mean_deviation, fill = period)) +"
"0","      geom_col() +"
"0","      geom_text(aes(label = sprintf(""%.3f"", mean_deviation)), vjust = -0.5) +"
"0","      labs(title = ""UST Average Peg Deviation by Period"","
"0","           x = ""Period"", y = ""Mean Deviation from $1 peg"")"
"0","  }"
"0","}"
