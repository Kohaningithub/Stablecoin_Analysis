"0","# Check if topic modeling produced results"
"0","if(!is.null(results$topics$model)) {"
"0","  topics <- results$topics$model"
"0","  "
"0","  # 1. Create a heatmap of topic distributions over time"
"0","  topic_distributions <- data.frame("
"0","    date = as.Date(rownames(topics$omega)),"
"0","    topics$omega"
"0","  )"
"0","  "
"0","  topic_distributions_long <- topic_distributions %>%"
"0","    pivot_longer("
"0","      cols = starts_with(""X""),"
"0","      names_to = ""topic"","
"0","      values_to = ""weight"""
"0","    )"
"0","  "
"0","  ggplot(topic_distributions_long, aes(x = date, y = topic, fill = weight)) +"
"0","    geom_tile() +"
"0","    scale_fill_viridis_c() +"
"0","    geom_vline(xintercept = as.Date(""2022-05-08""), linetype = ""dashed"") +"
"0","    geom_vline(xintercept = as.Date(""2022-05-15""), linetype = ""dashed"") +"
"0","    labs(title = ""Transaction Pattern Topics Over Time"","
"0","         x = ""Date"", y = ""Topic"", fill = ""Weight"")"
"0","  "
"0","  # 2. Visualize top terms for each topic"
"0","  top_terms <- data.frame()"
"0","  "
"0","  for(k in 1:ncol(topics$theta)) {"
"0","    top_pairs <- head(sort(topics$theta[,k], decreasing = TRUE), 10)"
"0","    topic_terms <- data.frame("
"0","      topic = paste(""Topic"", k),"
"0","      term = names(top_pairs),"
"0","      weight = top_pairs"
"0","    )"
"0","    top_terms <- rbind(top_terms, topic_terms)"
"0","  }"
"0","  "
"0","  # Plot top terms"
"0","  ggplot(top_terms, aes(x = reorder(term, weight), y = weight, fill = topic)) +"
"0","    geom_col() +"
"0","    facet_wrap(~topic, scales = ""free_y"") +"
"0","    coord_flip() +"
"0","    labs(title = ""Top Address Pairs by Topic"","
"0","         x = ""Address Pair"", y = ""Weight"") +"
"0","    theme(axis.text.y = element_text(size = 6))"
"0","  "
"0","  # 3. Interpret topics based on timing"
"0","  topic_timing <- topic_distributions %>%"
"0","    mutate("
"0","      period = case_when("
"0","        date < as.Date(""2022-05-08"") ~ ""pre_crash"","
"0","        date <= as.Date(""2022-05-15"") ~ ""crash_period"","
"0","        TRUE ~ ""post_crash"""
"0","      )"
"0","    ) %>%"
"0","    group_by(period) %>%"
"0","    summarize("
"0","      across(starts_with(""X""), mean),"
"0","      .groups = ""drop"""
"0","    )"
"0","  "
"0","  print(topic_timing)"
"0","}"
