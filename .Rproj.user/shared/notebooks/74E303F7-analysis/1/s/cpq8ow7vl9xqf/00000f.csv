"0","    # Analyze early warning signals"
"0","    # Create lagged features to identify potential warning signs"
"0","    ustc_early_warning <- ustc_data %>%"
"0","      arrange(date) %>%"
"0","      mutate("
"0","        peg_deviation_lag1 = lag(peg_deviation, 1),"
"0","        peg_deviation_lag2 = lag(peg_deviation, 2),"
"0","        peg_deviation_lag3 = lag(peg_deviation, 3),"
"0","        volatility_lag1 = lag(volatility, 1),"
"0","        volatility_lag2 = lag(volatility, 2),"
"0","        volatility_lag3 = lag(volatility, 3),"
"0","        volume_change = volume / lag(volume, 1) - 1,"
"0","        deviation_change = peg_deviation / peg_deviation_lag1 - 1,"
"0","        volatility_change = volatility / volatility_lag1 - 1,"
"0","        # Create a binary indicator for significant depegging (>5%)"
"0","        significant_depeg = peg_deviation > 0.05"
"0","      ) %>%"
"0","      filter(!is.na(peg_deviation_lag3)) # Ensure we have all lagged features"
"0","    "
"0","    # Visualize early warning signals with improved clarity"
"0","    p_warning <- ggplot(ustc_early_warning, aes(x = date)) +"
"0","      # Use thicker lines with better colors"
"0","      geom_line(aes(y = deviation_change, color = ""Deviation Change""), size = 1) +"
"0","      geom_line(aes(y = volatility_change, color = ""Volatility Change""), size = 1) +"
"0","      # Add vertical lines for crash period"
"0","      geom_vline(xintercept = as.Date(""2022-05-08""), linetype = ""dashed"", color = ""black"") +"
"0","      geom_vline(xintercept = as.Date(""2022-05-15""), linetype = ""dashed"", color = ""black"") +"
"0","      # Add annotations"
"0","      annotate(""text"", x = as.Date(""2022-05-01""), y = 45, "
"0","               label = ""Crash Period â†’"", hjust = 1, fontface = ""bold"", size = 3.5) +"
"0","      # Add highlighting for pre-crash warning signals"
"0","      annotate(""rect"", "
"0","               xmin = as.Date(""2022-04-01""), xmax = as.Date(""2022-05-07""),"
"0","               ymin = 0, ymax = 50,"
"0","               alpha = 0.1, fill = ""yellow"") +"
"0","      annotate(""text"", x = as.Date(""2022-04-15""), y = 40,"
"0","               label = ""Early Warning Signals"", fontface = ""italic"", size = 3.5) +"
"0","      # Improve colors and legend"
"0","      scale_color_manual(values = c(""Deviation Change"" = ""#FF5252"", ""Volatility Change"" = ""#2196F3""),"
"0","                        name = ""Metric"") +"
"0","      # Limit y-axis to focus on meaningful changes"
"0","      coord_cartesian(ylim = c(0, 50)) +"
"0","      # Improve labels and styling"
"0","      labs(title = ""USTC Early Warning Signals"","
"0","           subtitle = ""Percentage changes in key metrics before and during crash"","
"0","           x = ""Date"", "
"0","           y = ""Percentage Change"","
"0","           caption = ""Note: Spikes in April (~30 days before crash) may have served as early warning signals"") +"
"0","      theme_minimal() +"
"0","      theme("
"0","        legend.position = ""bottom"","
"0","        panel.grid.minor = element_blank(),"
"0","        plot.title = element_text(face = ""bold"", size = 14),"
"0","        plot.subtitle = element_text(size = 11),"
"0","        plot.caption = element_text(face = ""italic"", hjust = 0)"
"0","      )"
"0","    print(p_warning)"
