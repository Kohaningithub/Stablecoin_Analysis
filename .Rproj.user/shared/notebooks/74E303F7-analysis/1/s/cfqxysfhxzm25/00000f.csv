"0","# Visualize predictions for each token"
"0","visualize_predictions <- function(model_results) {"
"0","  if(is.null(model_results) || length(model_results$models) == 0) {"
"0","    cat(""No model results to visualize\n"")"
"0","    return(NULL)"
"0","  }"
"0","  "
"0","  # For each token"
"0","  for(token_name in names(model_results$models)) {"
"0","    token_models <- model_results$models[[token_name]]"
"0","    "
"0","    # Get test data with predictions"
"0","    test_data <- token_models$test_data"
"0","    "
"0","    # Plot linear regression predictions"
"0","    p1 <- ggplot(test_data, aes(x = date)) +"
"0","      geom_line(aes(y = peg_deviation, color = ""Actual""), size = 1) +"
"0","      geom_line(aes(y = predicted_lm, color = ""Predicted (LM)""), linetype = ""dashed"", size = 1) +"
"0","      geom_vline(xintercept = as.Date(""2022-05-08""), linetype = ""dotted"") +"
"0","      geom_vline(xintercept = as.Date(""2022-05-15""), linetype = ""dotted"") +"
"0","      labs(title = paste(""Linear Regression Prediction for"", token_name),"
"0","           subtitle = paste(""RMSE:"", round(sqrt(mean((test_data$predicted_lm - test_data$peg_deviation)^2)), 6)),"
"0","           x = ""Date"", y = ""Peg Deviation"") +"
"0","      scale_color_manual(values = c(""Actual"" = ""blue"", ""Predicted (LM)"" = ""red"")) +"
"0","      theme_minimal()"
"0","    "
"0","    print(p1)"
"0","    "
"0","    # Plot LASSO predictions if available"
"0","    if(""predicted_lasso"" %in% names(test_data)) {"
"0","      p2 <- ggplot(test_data, aes(x = date)) +"
"0","        geom_line(aes(y = peg_deviation, color = ""Actual""), size = 1) +"
"0","        geom_line(aes(y = predicted_lasso, color = ""Predicted (LASSO)""), linetype = ""dashed"", size = 1) +"
"0","        geom_vline(xintercept = as.Date(""2022-05-08""), linetype = ""dotted"") +"
"0","        geom_vline(xintercept = as.Date(""2022-05-15""), linetype = ""dotted"") +"
"0","        labs(title = paste(""LASSO Prediction for"", token_name),"
"0","             subtitle = paste(""RMSE:"", round(sqrt(mean((test_data$predicted_lasso - test_data$peg_deviation)^2)), 6)),"
"0","             x = ""Date"", y = ""Peg Deviation"") +"
"0","        scale_color_manual(values = c(""Actual"" = ""blue"", ""Predicted (LASSO)"" = ""green"")) +"
"0","        theme_minimal()"
"0","      "
"0","      print(p2)"
"0","      "
"0","      # Compare predictions"
"0","      test_data_long <- test_data %>%"
"0","        select(date, peg_deviation, predicted_lm, predicted_lasso) %>%"
"0","        pivot_longer(cols = c(peg_deviation, predicted_lm, predicted_lasso),"
"0","                    names_to = ""type"", values_to = ""value"")"
"0","      "
"0","      p3 <- ggplot(test_data_long, aes(x = date, y = value, color = type)) +"
"0","        geom_line() +"
"0","        geom_vline(xintercept = as.Date(""2022-05-08""), linetype = ""dotted"") +"
"0","        geom_vline(xintercept = as.Date(""2022-05-15""), linetype = ""dotted"") +"
"0","        labs(title = paste(""Prediction Comparison for"", token_name),"
"0","             x = ""Date"", y = ""Peg Deviation"") +"
"0","        scale_color_manual(values = c(""peg_deviation"" = ""blue"", "
"0","                                     ""predicted_lm"" = ""red"","
"0","                                     ""predicted_lasso"" = ""green"")) +"
"0","        theme_minimal()"
"0","      "
"0","      print(p3)"
"0","    }"
"0","    "
"0","    # Plot actual vs predicted"
"0","    if(""predicted_lm"" %in% names(test_data)) {"
"0","      p4 <- ggplot(test_data, aes(x = peg_deviation, y = predicted_lm)) +"
"0","        geom_point() +"
"0","        geom_abline(intercept = 0, slope = 1, linetype = ""dashed"", color = ""red"") +"
"0","        labs(title = paste(""Actual vs Predicted for"", token_name),"
"0","             x = ""Actual Peg Deviation"", y = ""Predicted Peg Deviation"") +"
"0","        theme_minimal()"
"0","      "
"0","      print(p4)"
"0","    }"
"0","  }"
"0","}"
"0",""
"0","# Visualize predictions"
"0","visualize_predictions(token_model_results)"
